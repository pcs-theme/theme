(function(m,f){"function"===typeof define&&define.amd?define(f):"object"===typeof exports?module.exports=f():m.Lazy=f()})(this,function(m){function f(a){if(y(a))return new w(a);if("string"===typeof a)return new D(a);if(a instanceof d)return a;if(f.extensions){for(var b=f.extensions,c=b.length,e;!e&&c--;)e=b[c](a);if(e)return e}return new E(a)}function d(){}function x(a){this.sequence=a;this.index=-1}function p(a){this.parent=a;this.memo=[];this.iterator=void 0;this.complete=!1}function h(a,b){this.parent=a;this.mapFn=b}function L(a,b){this.iterator=a.getIterator();this.mapFn=b;this.index=-1}function z(a,b){this.parent=a;this.filterFn=b}function M(a,b){this.iterator=a.getIterator();this.filterFn=b;this.index=0}function N(a){this.parent=a}function B(a){this.sequence=a}function k(a,b){this.parent=a;this.arrays=b}function t(a,b){this.parent=a;this.count=b}function S(a,b){this.iterator=a.getIterator();this.count=b}function pa(a,b){this.parent=a;this.predicate=b}function qa(a,b){this.parent=a;this.count="number"===typeof b?b:1}function ra(a,b){this.parent=a;this.count="number"===typeof b?b:1}function sa(a,b){this.parent=a;this.predicate=b}function O(a,b){this.parent=a;this.sortFn=b}function ta(a,b,c){this.parent=a;this.keyFn=b;this.valFn=c}function ua(a,b,c){this.parent=a;this.keyFn=b;this.valFn=c}function va(a,b){this.parent=a;this.keyFn=b}function P(a,b){this.parent=a;this.keyFn=b}function wa(a,b){this.parent=a;this.arrays=b}function xa(a){this.parent=a}function ba(a,b){this.parent=a;this.each=b?this.eachShallow:this.eachRecursive}function ya(a,b){this.parent=a;this.values=b}function za(a,b){this.parent=a;this.arrays=b}function Aa(a,b){this.iterator=b;this.memo=a;this.currentIndex=0;this.currentValue=void 0}function F(a){this.iterator=a;this.set=new G;this.memo=[];this.currentValue=void 0}function Ba(a,b){this.parent=a;this.count=b}function Ca(a,b){this.parent=a;this.chunkSize=b}function Da(a,b){this.iterator=a.getIterator();this.size=b}function Ea(a,b){this.parent=a;this.callback=b}function Q(a,b){this.parent=a;this.array=b;var c=40>b.length?Q.prototype.eachArrayCache:Q.prototype.eachMemoizerCache;this.each=c}function Fa(a,b){this.parent=a;this.array=b}function n(){}function Ga(a){this.sequence=a;this.index=-1}function T(a,b){this.parent=a;this.mapFn=b}function Ha(a,b){this.parent=a;this.filterFn=b}function U(a){this.parent=a}function Ia(a,b){this.parent=a;this.count=b}function ca(a,b){this.parent=a;this.count="number"===typeof b?b:1}function da(a,b){this.parent=a;this.other=b}function V(a,b){this.parent=a;var c=100>a.length()?V.prototype.eachArrayCache:P.prototype.each;this.each=c;this.keyFn=b}function w(a){this.source=a}function W(a,b){this.parent=a;this.mapFn=b}function Ja(a,b){this.parent=a;this.filterFn=b}function C(a,b){this.parent=a;var c=a.source;c=40>c.length?C.prototype.eachNoCache:100>c.length?C.prototype.eachArrayCache:C.prototype.eachSetCache;this.each=c;this.keyFn=b}function X(a,b){this.parent=a;this.other=b}function l(){}function Ka(a){this.parent=a}function La(a){this.parent=a}function Ma(a,b){this.parent=a;this.filterFn=b}function ea(a,b){this.parent=a;this.other=b}function fa(a,b){this.parent=a;this.defaultValues=b}function Na(a){this.parent=a}function Oa(a,b,c){this.parent=a;this.others=b;this.mergeFn=c}function $a(a,b){var c;if("undefined"===typeof b)return a;if(a&&a.constructor===Object&&b&&b.constructor===Object)var e={};else if(y(a)&&y(b))e=[];else return b;for(c in a)e[c]=$a(a[c],b[c]);for(c in b)e[c]||(e[c]=b[c]);return e}function ha(a,b){this.parent=a;this.properties=b}function ia(a,b){this.parent=a;this.properties=b}function E(a){this.source=a}function q(){}function Y(a){this.source=f(a);this.index=-1}function ja(a,b,c){this.parent=a;this.start=Math.max(0,b);this.stop=c}function ka(a,b){this.parent=a;this.mapFn=b}function la(a){this.parent=a}function Pa(a,b){this.parent=a;this.pattern=b}function Qa(a,b){this.source=a;this.pattern=ma(b)}function Ra(a,b){this.parent=a;this.pattern=b}function Sa(a,b){this.source=a;this.pattern=ma(b)}function Ta(a,b){this.source=a;this.delimiter=b}function D(a){this.source=a}function H(a,b){this.get=a;this.fixedLength=b}function Ua(a){this.sequence=a;this.index=0;this.currentValue=null}function u(a,b){if(a instanceof u)throw Error("Sequence is already asynchronous!");this.parent=a;this.interval=b;this.onNextCallback=ab(b);var c="undefined"===typeof b&&"function"===typeof clearImmediate?clearImmediate:clearTimeout;this.cancelCallback=c}function v(a){this.resolveListeners=[];this.rejectListeners=[];this.state=I;this.cancelFn=a}function Z(a,b){if(a===b)a._reject(new TypeError("Cannot resolve a promise to itself"));else if(b instanceof v)b.then(function(b){Z(a,b)},function(b){a._reject(b)});else{try{var c=/function|object/.test(typeof b)&&null!=b&&b.then}catch(g){a._reject(g);return}var e=I;if("function"===typeof c)try{c.call(b,function(b){e===I&&(e=2,Z(a,b))},function(b){e===I&&(e=3,a._reject(b))})}catch(g){e===I&&a._reject(g)}else a._resolve(b)}}function Va(a,b,c){c||(c=ab());c(function(){0<a.length&&(a.shift()(b),Va(a,b,c))})}function ab(a){if("undefined"===typeof a&&"function"===typeof setImmediate)return setImmediate;a=a||0;return function(b){return setTimeout(b,a)}}function cb(a,b){return b instanceof v?b.then(function(){a(b)}):a(b)}function Wa(a,b){this.listeners=[];b?y(b)||(b=[b]):b=f(a).keys().toArray();var c=this.listeners,e=0;f(b).each(function(b){var g=a[b];Object.defineProperty(a,b,{get:function(){return g},set:function(a){for(var d=c.length-1;0<=d;--d)!1===c[d]({property:b,value:a},e)&&c.splice(d,1);g=a;++e}})})}function J(){}function aa(a,b){this.parent=a;this.delimiter=b;this.each=this.getEachForDelimiter(b)}function Xa(a,b){this.parent=a;this.pattern=ma(b)}function r(a,b){switch(typeof a){case "function":return a;case "string":return function(b){return b[a]};case "object":return function(b){return f(a).all(function(a,c){return b[c]===a})};case "undefined":return b?function(){return b}:f.identity;default:throw Error("Don't know how to make a callback from a "+typeof a+"!");}}function bb(a){if(!a)return na;a=r(a);return function(b,c){return na(a(b),a(c))}}function Ya(a){return function(b,c){return a(c,b)}}function db(a){var b=new G;f(a||[]).flatten().each(function(a){b.add(a)});return b}function na(a,b){return a===b?0:a>b?1:-1}function R(a,b){for(var c=-1,e=a.length;++c<e;)if(!1===b(a[c],c))return!1;return!0}function eb(a){var b;a.each(function(a){b=a;return!1});return b}function A(a,b){var c=-1,e=a.length;if(b!==b){for(;++c<e;)if(a[c]!==a[c])return!0;return!1}for(;++c<e;)if(a[c]===b)return!0;return!1}function ma(a){return eval(""+a+(a.global?"":"g"))}function G(){this.table={};this.objects=[]}function Za(a){this.contents=Array(a);this.count=this.start=0}function oa(a,b,c){var e=function(){};e.prototype=new a;for(var g in c)e.prototype[g]=c[g];c=function(){var a=new e;a.parent=this;a.init&&a.init.apply(a,arguments);return a};b="string"===typeof b?[b]:b;for(g=0;g<b.length;++g)a.prototype[b[g]]=c;return e}f.VERSION="0.5.1";f.noop=function(){};f.identity=function(a){return a};f.equality=function(a,b){return a===b};f.strict=function(){function a(a){if(null==a)throw Error("You cannot wrap null or undefined using Lazy.");if("number"===typeof a||"boolean"===typeof a)throw Error("You cannot wrap primitive values using Lazy.");return f(a)}f(f).each(function(b,c){a[c]=b});return a};d.define=function(a,b){if(!b||!b.getIterator&&!b.each)throw Error("A custom sequence must implement *at least* getIterator or each!");return oa(d,a,b)};d.prototype.size=function(){return this.getIndex().length()};d.prototype.getIterator=function(){return new x(this)};d.prototype.root=function(){return this.parent.root()};d.prototype.isAsync=function(){return this.parent?this.parent.isAsync():!1};d.prototype.value=function(){return this.toArray()};d.prototype.apply=function(a){var b=this.root(),c=b.source;try{b.source=a;var e=this.value()}finally{b.source=c}return e};x.prototype.current=function(){return this.cachedIndex&&this.cachedIndex.get(this.index)};x.prototype.moveNext=function(){var a=this.cachedIndex;a||(a=this.cachedIndex=this.sequence.getIndex());if(this.index>=a.length()-1)return!1;++this.index;return!0};d.prototype.toArray=function(){return this.reduce(function(a,b){a.push(b);return a},[])};d.prototype.equals=function(a,b){if(!(a instanceof d))return!1;for(var c=this.getIterator(),e=a.getIterator(),g=b||f.equality;c.moveNext();)if(!e.moveNext()||!g(c.current(),e.current()))return!1;return!e.moveNext()};d.prototype.getIndex=function(){return new w(this.toArray())};d.prototype.get=function(a){var b;this.each(function(c,e){if(e===a)return b=c,!1});return b};d.prototype.memoize=function(){return new p(this)};d.prototype.toObject=function(){return this.reduce(function(a,b){a[b[0]]=b[1];return a},{})};d.prototype.each=function(a){for(var b=this.getIterator(),c=-1;b.moveNext();)if(!1===a(b.current(),++c))return!1;return!0};d.prototype.forEach=function(a){return this.each(a)};d.prototype.map=function(a){return new h(this,r(a))};d.prototype.collect=function(a){return this.map(a)};h.prototype=Object.create(d.prototype);h.prototype.getIterator=function(){return new L(this.parent,this.mapFn)};h.prototype.each=function(a){var b=this.mapFn;return this.parent.each(function(c,e){return a(b(c,e),e)})};L.prototype.current=function(){return this.mapFn(this.iterator.current(),this.index)};L.prototype.moveNext=function(){return this.iterator.moveNext()?(++this.index,!0):!1};d.prototype.pluck=function(a){return this.map(a)};d.prototype.invoke=function(a){return this.map(function(b){return b[a]()})};d.prototype.filter=function(a){return new z(this,r(a))};d.prototype.select=function(a){return this.filter(a)};z.prototype=Object.create(d.prototype);z.prototype.getIterator=function(){return new M(this.parent,this.filterFn)};z.prototype.each=function(a){var b=this.filterFn,c=0;return this.parent.each(function(e,g){if(b(e,g))return a(e,c++)})};z.prototype.reverse=function(){return this.parent.reverse().filter(this.filterFn)};M.prototype.current=function(){return this.value};M.prototype.moveNext=function(){for(var a=this.iterator,b=this.filterFn,c;a.moveNext();)if(c=a.current(),b(c,this.index++))return this.value=c,!0;this.value=void 0;return!1};d.prototype.reject=function(a){a=r(a);return this.filter(function(b){return!a(b)})};d.prototype.ofType=function(a){return this.filter(function(b){return typeof b===a})};d.prototype.where=function(a){return this.filter(a)};d.prototype.reverse=function(){return new N(this)};N.prototype=Object.create(d.prototype);N.prototype.getIterator=function(){return new B(this.parent)};B.prototype.current=function(){return this.getIndex().get(this.index)};B.prototype.moveNext=function(){var a=this.getIndex().length();"undefined"===typeof this.index&&(this.index=a);return 0<=--this.index};B.prototype.getIndex=function(){this.cachedIndex||(this.cachedIndex=this.sequence.getIndex());return this.cachedIndex};d.prototype.concat=function(a){return new k(this,K.call(arguments,0))};k.prototype=Object.create(d.prototype);k.prototype.each=function(a){var b=!1,c=0;this.parent.each(function(e){if(!1===a(e,c++))return b=!0,!1});b||f(this.arrays).flatten(!0).each(function(b){if(!1===a(b,c++))return!1})};d.prototype.first=function(a){return"undefined"===typeof a?eb(this):new t(this,a)};d.prototype.head=d.prototype.take=function(a){return this.first(a)};t.prototype=Object.create(d.prototype);t.prototype.getIterator=function(){return new S(this.parent,this.count)};t.prototype.each=function(a){var b=this.count,c=0,e,g=this.parent.each(function(g){c<b&&(e=a(g,c++));return c>=b?!1:e});return g instanceof v?g:c===b&&!1!==e};S.prototype.current=function(){return this.iterator.current()};S.prototype.moveNext=function(){return 0<=--this.count&&this.iterator.moveNext()};d.prototype.takeWhile=function(a){return new pa(this,a)};pa.prototype=Object.create(d.prototype);pa.prototype.each=function(a){var b=this.predicate,c=!1,e=0,g=this.parent.each(function(g,d){return b(g,d)?a(g,e++):(c=!0,!1)});return g instanceof v?g:c};d.prototype.initial=function(a){return new qa(this,a)};qa.prototype=Object.create(d.prototype);qa.prototype.each=function(a){var b=this.parent.getIndex();return b.take(b.length()-this.count).each(a)};d.prototype.last=function(a){return"undefined"===typeof a?this.reverse().first():this.reverse().take(a).reverse()};d.prototype.findWhere=function(a){return this.where(a).first()};d.prototype.rest=function(a){return new ra(this,a)};d.prototype.skip=d.prototype.tail=d.prototype.drop=function(a){return this.rest(a)};ra.prototype=Object.create(d.prototype);ra.prototype.each=function(a){var b=this.count,c=0,e=0;return this.parent.each(function(g){if(!(c++<b))return a(g,e++)})};d.prototype.dropWhile=function(a){return new sa(this,a)};d.prototype.skipWhile=function(a){return this.dropWhile(a)};sa.prototype=Object.create(d.prototype);sa.prototype.each=function(a){var b=this.predicate,c=!1;return this.parent.each(function(e){if(!c){if(b(e))return;c=!0}return a(e)})};d.prototype.sort=function(a,b){a||(a=na);b&&(a=Ya(a));return new O(this,a)};d.prototype.sortBy=function(a,b){a=bb(a);b&&(a=Ya(a));return new O(this,a)};O.prototype=Object.create(d.prototype);O.prototype.each=function(a){var b=this.sortFn,c=this.parent.toArray();c.sort(b);return R(c,a)};O.prototype.reverse=function(){return new O(this.parent,Ya(this.sortFn))};d.prototype.groupBy=function(a,b){return new ta(this,a,b)};d.prototype.indexBy=function(a,b){return new ua(this,a,b)};d.prototype.countBy=function(a){return new va(this,a)};d.prototype.uniq=function(a){return new P(this,a)};d.prototype.unique=function(a){return this.uniq(a)};P.prototype=Object.create(d.prototype);P.prototype.each=function(a){var b=new G,c=this.keyFn,e=0;return c?(c=r(c),this.parent.each(function(g){if(b.add(c(g)))return a(g,e++)})):this.parent.each(function(c){if(b.add(c))return a(c,e++)})};d.prototype.zip=function(a){return 1===arguments.length?new Fa(this,a):new wa(this,K.call(arguments,0))};wa.prototype=Object.create(d.prototype);wa.prototype.each=function(a){var b=this.arrays,c=0;if(!this.parent.each(function(e){e=[e];for(var g=0;g<b.length;++g)e.push(b[g][c]);return a(e,c++)}))return!1;for(var e,g=!0;g;){g=!1;e=[void 0];for(var d=0;d<b.length;++d)e.push(b[d][c]),b[d].length>c&&(g=!0);if(g&&!1===a(e,c++))return!1}return!0};d.prototype.shuffle=function(){return new xa(this)};xa.prototype=Object.create(d.prototype);xa.prototype.each=function(a){for(var b=this.parent.toArray(),c=Math.floor,e=Math.random,g=0,d=b.length-1;0<d;--d){var f=b,k=c(e()*(d+1)),h=f[d];f[d]=f[k];f[k]=h;if(!1===a(b[d],g++))return!1}b.length&&a(b[0],g);return!0};d.prototype.flatten=function(a){return new ba(this,a)};ba.prototype=Object.create(d.prototype);ba.prototype.eachShallow=function(a){var b=0;return this.parent.each(function(c){return y(c)?R(c,function(c){return a(c,b++)}):c instanceof d?c.each(function(c){return a(c,b++)}):a(c,b++)})};ba.prototype.eachRecursive=function(a){var b=0;return this.parent.each(function g(e){return y(e)?R(e,g):e instanceof d?e.each(g):a(e,b++)})};d.prototype.compact=function(){return this.filter(function(a){return!!a})};d.prototype.without=function(a){return new ya(this,K.call(arguments,0))};d.prototype.difference=function(a){return this.without.apply(this,arguments)};ya.prototype=Object.create(d.prototype);ya.prototype.each=function(a){var b=db(this.values),c=0;return this.parent.each(function(e){if(!b.contains(e))return a(e,c++)})};d.prototype.union=function(a){return this.concat(a).uniq()};d.prototype.intersection=function(a){return 1===arguments.length&&y(arguments[0])?new Q(this,a):new za(this,K.call(arguments,0))};za.prototype=Object.create(d.prototype);za.prototype.each=function(a){var b=f(this.arrays).map(function(a){return new F(f(a).getIterator())}),c=new F(b.getIterator()),e=0;return this.parent.uniq().each(function(b){var d=!0;c.each(function(a){if(!a.contains(b))return d=!1});if(d)return a(b,e++)})};Aa.prototype.current=function(){return this.currentValue};Aa.prototype.moveNext=function(){var a=this.iterator,b=this.memo;return this.currentIndex<b.length?(this.currentValue=b[this.currentIndex++],!0):a.moveNext()?(this.currentValue=b[this.currentIndex++]=a.current(),!0):!1};F.prototype.current=function(){return this.currentValue};F.prototype.moveNext=function(){for(var a=this.iterator,b=this.set,c=this.memo,e;a.moveNext();)if(e=a.current(),b.add(e))return c.push(e),this.currentValue=e,!0;return!1};F.prototype.each=function(a){for(var b=this.memo,c=b.length,e=-1;++e<c;)if(!1===a(b[e],e))return!1;for(;this.moveNext()&&!1!==a(this.currentValue,e++););};F.prototype.contains=function(a){if(this.set.contains(a))return!0;for(;this.moveNext();)if(this.currentValue===a)return!0;return!1};d.prototype.every=function(a){a=r(a);return this.each(function(b,c){return!!a(b,c)})};d.prototype.all=function(a){return this.every(a)};d.prototype.some=function(a){a=r(a,!0);var b=!1;this.each(function(c){if(a(c))return b=!0,!1});return b};d.prototype.any=function(a){return this.some(a)};d.prototype.none=function(a){return!this.any(a)};d.prototype.isEmpty=function(){return!this.any()};d.prototype.indexOf=function(a,b){var c=b||f.equality,e=-1;this.each(function(b,d){if(c(b,a))return e=d,!1});return e};d.prototype.lastIndexOf=function(a,b){var c=this.getIndex().reverse(),e=c.indexOf(a,b);-1!==e&&(e=c.length()-e-1);return e};d.prototype.sortedIndex=function(a){for(var b=this.getIndex(),c=0,e=b.length(),d;c<e;)d=c+e>>>1,-1===na(b.get(d),a)?c=d+1:e=d;return c};d.prototype.contains=function(a,b){return-1!==this.indexOf(a,b)};d.prototype.reduce=function(a,b){if(2>arguments.length)return this.tail().reduce(a,this.head());var c=this.each(function(c,d){b=a(b,c,d)});return c instanceof v?c.then(function(){return b}):b};d.prototype.inject=d.prototype.foldl=function(a,b){return this.reduce(a,b)};d.prototype.reduceRight=function(a,b){if(2>arguments.length)return this.initial(1).reduceRight(a,this.last());var c=this.getIndex(),e=c.length()-1;return c.reverse().reduce(function(b,c){return a(b,c,e--)},b)};d.prototype.foldr=function(a,b){return this.reduceRight(a,b)};d.prototype.consecutive=function(a){return new Ba(this,a)};Ba.prototype=Object.create(d.prototype);Ba.prototype.each=function(a){var b=this.count,c=new Za(b);return this.parent.map(function(a){if(c.add(a).count===b)return c.toArray()}).compact().each(a)};d.prototype.chunk=function(a){if(1>a)throw Error("You must specify a positive chunk size.");return new Ca(this,a)};Ca.prototype=Object.create(d.prototype);Ca.prototype.getIterator=function(){return new Da(this.parent,this.chunkSize)};Da.prototype.current=function(){return this.currentChunk};Da.prototype.moveNext=function(){for(var a=this.iterator,b=this.size,c=[];c.length<b&&a.moveNext();)c.push(a.current());if(0===c.length)return!1;this.currentChunk=c;return!0};d.prototype.tap=function(a){return new Ea(this,a)};Ea.prototype=Object.create(d.prototype);Ea.prototype.each=function(a){var b=this.callback;return this.parent.each(function(c,e){b(c,e);return a(c,e)})};d.prototype.find=function(a){return this.filter(a).first()};d.prototype.detect=function(a){return this.find(a)};d.prototype.min=function(a){return"undefined"!==typeof a?this.minBy(a):this.reduce(function(a,c,e){return"undefined"===typeof a?c:c<a?c:a})};d.prototype.minBy=function(a){a=r(a);return this.reduce(function(b,c){return a(c)<a(b)?c:b})};d.prototype.max=function(a){return"undefined"!==typeof a?this.maxBy(a):this.reduce(function(a,c,e){return"undefined"===typeof a?c:c>a?c:a})};d.prototype.maxBy=function(a){a=r(a);return this.reduce(function(b,c){return a(c)>a(b)?c:b})};d.prototype.sum=function(a){return"undefined"!==typeof a?this.sumBy(a):this.reduce(function(a,c){return a+c},0)};d.prototype.sumBy=function(a){a=r(a);return this.reduce(function(b,c){return b+a(c)},0)};d.prototype.join=function(a){a="undefined"===typeof a?",":String(a);var b=-1;return this.reduce(function(c,e){0<++b&&(c+=a);return c+e},"")};d.prototype.toString=function(a){return this.join(a)};d.prototype.async=function(a){return new u(this,a)};Q.prototype=Object.create(d.prototype);Q.prototype.eachMemoizerCache=function(a){var b=new F(f(this.array).getIterator()),c=0;return this.parent.uniq().each(function(e){if(b.contains(e))return a(e,c++)})};Q.prototype.eachArrayCache=function(a){var b=this.array,c=0;return this.parent.uniq().each(function(e){if(A(b,e))return a(e,c++)})};Fa.prototype=Object.create(d.prototype);Fa.prototype.each=function(a){var b=this.array,c=-1;if(!this.parent.each(function(e){++c;return a([e,b[c]],c)}))return!1;for(;++c<b.length;)if(!1===a([void 0,b[c]],c))return!1;return!0};n.prototype=Object.create(d.prototype);n.define=function(a,b){if(!b||"function"!==typeof b.get)throw Error("A custom array-like sequence must implement *at least* get!");return oa(n,a,b)};n.prototype.get=function(a){return this.parent.get(a)};n.prototype.length=function(){return this.parent.length()};n.prototype.getIndex=function(){return this};n.prototype.getIterator=function(){return new Ga(this)};Ga.prototype.current=function(){return this.sequence.get(this.index)};Ga.prototype.moveNext=function(){if(this.index>=this.sequence.length()-1)return!1;++this.index;return!0};n.prototype.each=function(a){for(var b=this.length(),c=-1;++c<b;)if(!1===a(this.get(c),c))return!1;return!0};n.prototype.push=function(a){return this.concat([a])};n.prototype.pop=function(){return this.initial()};n.prototype.unshift=function(a){return f([a]).concat(this)};n.prototype.shift=function(){return this.drop()};n.prototype.slice=function(a,b){var c=this.length();0>a&&(a=c+a);var e=this.drop(a);"number"===typeof b&&(0>b&&(b=c+b),e=e.take(b-a));return e};n.prototype.map=function(a){return new T(this,r(a))};T.prototype=Object.create(n.prototype);T.prototype.get=function(a){if(!(0>a||a>=this.parent.length()))return this.mapFn(this.parent.get(a),a)};n.prototype.filter=function(a){return new Ha(this,r(a))};Ha.prototype=Object.create(z.prototype);Ha.prototype.each=function(a){for(var b=this.parent,c=this.filterFn,e=this.parent.length(),d=-1,f=0,k;++d<e;)if(k=b.get(d),c(k,d)&&!1===a(k,f++))return!1;return!0};n.prototype.reverse=function(){return new U(this)};U.prototype=Object.create(n.prototype);U.prototype.get=function(a){return this.parent.get(this.length()-a-1)};n.prototype.first=function(a){return"undefined"===typeof a?this.get(0):new Ia(this,a)};Ia.prototype=Object.create(n.prototype);Ia.prototype.length=function(){var a=this.parent.length();return this.count<=a?this.count:a};n.prototype.rest=function(a){return new ca(this,a)};ca.prototype=Object.create(n.prototype);ca.prototype.get=function(a){return this.parent.get(this.count+a)};ca.prototype.length=function(){var a=this.parent.length();return this.count<=a?a-this.count:0};n.prototype.concat=function(a){return 1===arguments.length&&y(arguments[0])?new da(this,a):d.prototype.concat.apply(this,arguments)};da.prototype=Object.create(n.prototype);da.prototype.get=function(a){var b=this.parent.length();return a<b?this.parent.get(a):this.other[a-b]};da.prototype.length=function(){return this.parent.length()+this.other.length};n.prototype.uniq=function(a){return new V(this,r(a))};V.prototype=Object.create(d.prototype);V.prototype.eachArrayCache=function(a){for(var b=this.parent,c=this.keyFn,e=b.length(),d=[],f,k,h=-1,l=0;++h<e;)if(k=b.get(h),f=c(k),!A(d,f)&&(d.push(f),!1===a(k,l++)))return!1};V.prototype.eachSetCache=P.prototype.each;p.prototype=Object.create(d.prototype);p.prototype.getParentIterator=function(){this.iterator||(this.iterator=this.parent.getIterator());return this.iterator};p.prototype.getIterator=function(){return new Aa(this.memo,this.getParentIterator())};p.prototype.iterateTo=function(a){for(var b=this.memo,c=this.getParentIterator();a>=b.length;){if(!c.moveNext())return this.complete=!0,!1;b.push(c.current())}return!0};p.prototype.get=function(a){var b=this.memo;if(a<b.length||this.iterateTo(a))return b[a]};p.prototype.length=function(){this.complete||this.iterateTo(Infinity);return this.memo.length};p.prototype.slice=function(a,b){this.complete||this.iterateTo(b);return f(this.memo.slice(a,b))};p.prototype.toArray=function(){this.complete||this.iterateTo(Infinity);return this.memo.slice(0)};w.prototype=Object.create(n.prototype);w.prototype.root=function(){return this};w.prototype.isAsync=function(){return!1};w.prototype.get=function(a){return this.source[a]};w.prototype.length=function(){return this.source.length};w.prototype.each=function(a){return R(this.source,a)};w.prototype.map=function(a){return new W(this,r(a))};w.prototype.filter=function(a){return new Ja(this,r(a))};w.prototype.uniq=function(a){return new C(this,a)};w.prototype.concat=function(a){return 1===arguments.length&&y(arguments[0])?new X(this,a):n.prototype.concat.apply(this,arguments)};w.prototype.toArray=function(){return this.source.slice(0)};W.prototype=Object.create(n.prototype);W.prototype.get=function(a){var b=this.parent.source;if(!(0>a||a>=b.length))return this.mapFn(b[a])};W.prototype.length=function(){return this.parent.source.length};W.prototype.each=function(a){for(var b=this.parent.source,c=b.length,e=this.mapFn,d=-1;++d<c;)if(!1===a(e(b[d],d),d))return!1;return!0};Ja.prototype=Object.create(z.prototype);Ja.prototype.each=function(a){for(var b=this.parent.source,c=this.filterFn,e=b.length,d=-1,f=0,k;++d<e;)if(k=b[d],c(k,d)&&!1===a(k,f++))return!1;return!0};C.prototype=Object.create(d.prototype);C.prototype.eachNoCache=function(a){for(var b=this.parent.source,c=this.keyFn,e=b.length,d,f=-1,k=0;++f<e;){d=b[f];a:{var h=b;var l=d,t=f,n=c,q=-1;if(n)for(n=r(n);++q<t;){if(n(h[q])===n(l)){h=!0;break a}}else for(;++q<t;)if(h[q]===l){h=!0;break a}h=!1}if(!h&&!1===a(d,k++))return!1}return!0};C.prototype.eachArrayCache=function(a){var b=this.parent.source,c=this.keyFn,e=b.length,d=[],f=-1,k=0;if(c)for(c=r(c);++f<e;){var h=b[f];var l=c(h);if(!A(d,l)&&(d.push(l),!1===a(h,k++)))return!1}else for(;++f<e;)if(h=b[f],!A(d,h)&&(d.push(h),!1===a(h,k++)))return!1;return!0};C.prototype.eachSetCache=P.prototype.each;X.prototype=Object.create(n.prototype);X.prototype.get=function(a){var b=this.parent.source,c=b.length;return a<c?b[a]:this.other[a-c]};X.prototype.length=function(){return this.parent.source.length+this.other.length};X.prototype.each=function(a){for(var b=this.parent.source,c=b.length,e=this.other,d=e.length,f=0,k=-1;++k<c;)if(!1===a(b[k],f++))return!1;for(k=-1;++k<d;)if(!1===a(e[k],f++))return!1;return!0};l.prototype=Object.create(d.prototype);l.define=function(a,b){if(!b||"function"!==typeof b.each)throw Error("A custom object-like sequence must implement *at least* each!");return oa(l,a,b)};l.prototype.value=function(){return this.toObject()};l.prototype.get=function(a){var b=this.pairs().find(function(b){return String(b[0])===String(a)});return b?b[1]:void 0};l.prototype.keys=function(){return new Ka(this)};Ka.prototype=Object.create(d.prototype);Ka.prototype.each=function(a){var b=-1;return this.parent.each(function(c,e){return a(e,++b)})};l.prototype.values=function(){return new La(this)};La.prototype=Object.create(d.prototype);La.prototype.each=function(a){var b=-1;return this.parent.each(function(c,e){return a(c,++b)})};l.prototype.async=function(){throw Error("An ObjectLikeSequence does not support asynchronous iteration.");};l.prototype.filter=function(a){return new Ma(this,r(a))};Ma.prototype=Object.create(l.prototype);Ma.prototype.each=function(a){var b=this.filterFn;return this.parent.each(function(c,e){if(b(c,e))return a(c,e)})};l.prototype.reverse=function(){return this};l.prototype.assign=function(a){return new ea(this,a)};l.prototype.extend=function(a){return this.assign(a)};ea.prototype=Object.create(l.prototype);ea.prototype.get=function(a){return a in this.other?this.other[a]:this.parent.get(a)};ea.prototype.each=function(a){var b=new G,c=!1;f(this.other).each(function(e,d){if(!1===a(e,d))return c=!0,!1;b.add(d)});if(!c)return this.parent.each(function(c,d){if(!b.contains(d)&&!1===a(c,d))return!1})};l.prototype.defaults=function a(a){return new fa(this,a)};fa.prototype=Object.create(l.prototype);fa.prototype.get=function(a){var b=this.parent.get(a);return void 0!==b?b:this.defaultValues[a]};fa.prototype.each=function(a){var b=new G,c=!1;this.parent.each(function(e,d){if(!1===a(e,d))return c=!0,!1;"undefined"!==typeof e&&b.add(d)});c||f(this.defaultValues).each(function(c,d){if(!b.contains(d)&&!1===a(c,d))return!1})};l.prototype.invert=function(){return new Na(this)};Na.prototype=Object.create(l.prototype);Na.prototype.each=function(a){this.parent.each(function(b,c){return a(c,b)})};l.prototype.merge=function(a){var b=1<arguments.length&&"function"===typeof arguments[arguments.length-1]?hb.call(arguments):null;return new Oa(this,K.call(arguments,0),b)};Oa.prototype=Object.create(l.prototype);Oa.prototype.each=function(a){var b=this.others,c=this.mergeFn||$a,e={};if(!1===this.parent.each(function(d,f){var g=d;R(b,function(a){f in a&&(g=c(g,a[f]))});e[f]=!0;return a(g,f)}))return!1;var d={};R(b,function(a){for(var b in a)e[b]||(d[b]=c(d[b],a[b]))});return f(d).each(a)};l.prototype.functions=function(){return this.filter(function(a,b){return"function"===typeof a}).map(function(a,b){return b})};l.prototype.methods=function(){return this.functions()};l.prototype.pick=function(a){return new ha(this,a)};ha.prototype=Object.create(l.prototype);ha.prototype.get=function(a){return A(this.properties,a)?this.parent.get(a):void 0};ha.prototype.each=function(a){var b=this.properties;return this.parent.each(function(c,e){if(A(b,e))return a(c,e)})};l.prototype.omit=function(a){return new ia(this,a)};ia.prototype=Object.create(l.prototype);ia.prototype.get=function(a){return A(this.properties,a)?void 0:this.parent.get(a)};ia.prototype.each=function(a){var b=this.properties;return this.parent.each(function(c,e){if(!A(b,e))return a(c,e)})};l.prototype.pairs=function(){return this.map(function(a,b){return[b,a]})};l.prototype.toArray=function(){return this.pairs().toArray()};l.prototype.toObject=function(){return this.reduce(function(a,b,c){a[c]=b;return a},{})};ta.prototype=Object.create(l.prototype);ta.prototype.each=function(a){var b=r(this.keyFn),c=r(this.valFn);var e=this.parent.reduce(function(a,e){var d=b(e),f=c(e);y(a[d])?a[d].push(f):a[d]=[f];return a},{});return cb(function(b){for(var c in b)if(!1===a(b[c],c))return!1;return!0},e)};ua.prototype=Object.create(l.prototype);ua.prototype.each=function(a){var b=r(this.keyFn),c=r(this.valFn),e={};return this.parent.each(function(d){var f=b(d);d=c(d);if(!e[f])return e[f]=d,a(d,f)})};va.prototype=Object.create(l.prototype);va.prototype.each=function(a){var b=r(this.keyFn),c={};this.parent.each(function(a){a=b(a);c[a]=c[a]?c[a]+1:1});for(var e in c)if(!1===a(c[e],e))return!1;return!0};l.prototype.watch=function(a){throw Error("You can only call #watch on a directly wrapped object.");};E.prototype=Object.create(l.prototype);E.prototype.root=function(){return this};E.prototype.isAsync=function(){return!1};E.prototype.get=function(a){return this.source[a]};E.prototype.each=function(a){var b=this.source,c=b?Object.keys(b):[],e=c.length,d;for(d=0;d<e;++d){var f=c[d];if(!1===a(b[f],f))return!1}return!0};q.prototype=Object.create(n.prototype);q.define=function(a,b){if(!b||"function"!==typeof b.get)throw Error("A custom string-like sequence must implement *at least* get!");return oa(q,a,b)};q.prototype.value=function(){return this.toString()};q.prototype.getIterator=function(){return new Y(this)};Y.prototype.current=function(){return this.source.charAt(this.index)};Y.prototype.moveNext=function(){return++this.index<this.source.length()};q.prototype.charAt=function(a){return this.get(a)};q.prototype.charCodeAt=function(a){return(a=this.charAt(a))?a.charCodeAt(0):NaN};q.prototype.substring=function(a,b){return new ja(this,a,b)};ja.prototype=Object.create(q.prototype);ja.prototype.get=function(a){return this.parent.get(a+this.start)};ja.prototype.length=function(){return("number"===typeof this.stop?this.stop:this.parent.length())-this.start};q.prototype.first=function(a){return"undefined"===typeof a?this.charAt(0):this.substring(0,a)};q.prototype.last=function(a){return"undefined"===typeof a?this.charAt(this.length()-1):this.substring(this.length()-a)};q.prototype.drop=function(a){return this.substring(a)};q.prototype.indexOf=function(a,b){return this.toString().indexOf(a,b)};q.prototype.lastIndexOf=function(a,b){return this.toString().lastIndexOf(a,b)};q.prototype.contains=function(a){return-1!==this.indexOf(a)};q.prototype.endsWith=function(a){return this.substring(this.length()-a.length).toString()===a};q.prototype.startsWith=function(a){return this.substring(0,a.length).toString()===a};q.prototype.toUpperCase=function(){return this.mapString(function(a){return a.toUpperCase()})};q.prototype.toLowerCase=function(){return this.mapString(function(a){return a.toLowerCase()})};q.prototype.mapString=function(a){return new ka(this,a)};ka.prototype=Object.create(q.prototype);ka.prototype.get=T.prototype.get;ka.prototype.length=T.prototype.length;q.prototype.reverse=function(){return new la(this)};la.prototype=Object.create(q.prototype);la.prototype.get=U.prototype.get;la.prototype.length=U.prototype.length;q.prototype.toString=function(){return this.join("")};q.prototype.match=function(a){return new Pa(this,a)};Pa.prototype=Object.create(d.prototype);Pa.prototype.getIterator=function(){return new Qa(this.parent.toString(),this.pattern)};Qa.prototype.current=function(){return this.match[0]};Qa.prototype.moveNext=function(){return!!(this.match=this.pattern.exec(this.source))};q.prototype.split=function(a){return new Ra(this,a)};Ra.prototype=Object.create(d.prototype);Ra.prototype.getIterator=function(){var a=this.parent.toString();return this.pattern instanceof RegExp?""===this.pattern.source||"(?:)"===this.pattern.source?new Y(a):new Sa(a,this.pattern):""===this.pattern?new Y(a):new Ta(a,this.pattern)};Sa.prototype.current=function(){return this.source.substring(this.start,this.end)};Sa.prototype.moveNext=function(){if(!this.pattern)return!1;var a=this.pattern.exec(this.source);return a?(this.start=this.nextStart?this.nextStart:0,this.end=a.index,this.nextStart=a.index+a[0].length,!0):this.pattern?(this.start=this.nextStart,this.pattern=this.nextStart=this.end=void 0,!0):!1};Ta.prototype.current=function(){return this.source.substring(this.leftIndex,this.rightIndex)};Ta.prototype.moveNext=function(){this.finished||(this.leftIndex="undefined"!==typeof this.leftIndex?this.rightIndex+this.delimiter.length:0,this.rightIndex=this.source.indexOf(this.delimiter,this.leftIndex));return-1===this.rightIndex?(this.finished=!0,this.rightIndex=void 0,!0):!this.finished};D.prototype=Object.create(q.prototype);D.prototype.root=function(){return this};D.prototype.isAsync=function(){return!1};D.prototype.get=function(a){return this.source.charAt(a)};D.prototype.length=function(){return this.source.length};D.prototype.toString=function(){return this.source};H.prototype=Object.create(d.prototype);H.prototype.isAsync=function(){return!1};H.prototype.length=function(){return this.fixedLength};H.prototype.each=function(a){for(var b=this.get,c=this.fixedLength,d=0;"undefined"===typeof c||d<c;)if(!1===a(b(d),d++))return!1;return!0};H.prototype.getIterator=function(){return new Ua(this)};Ua.prototype.current=function(){return this.currentValue};Ua.prototype.moveNext=function(){var a=this.sequence;if("number"===typeof a.fixedLength&&this.index>=a.fixedLength)return!1;this.currentValue=a.get(this.index++);return!0};u.prototype=Object.create(d.prototype);u.prototype.isAsync=function(){return!0};u.prototype.getIterator=function(){throw Error("An AsyncSequence does not support synchronous iteration.");};u.prototype.each=function(a){var b=this.parent.getIterator(),c=this.onNextCallback,d=this.cancelCallback,f=0,k=new v(function(){h&&d(h)}),h=c(function fb(){h=null;try{b.moveNext()&&!1!==a(b.current(),f++)?h=c(fb):k._resolve()}catch(gb){k._reject(gb)}});return k};var I=1;v.prototype.then=function(a,b){var c=new v(this.cancelFn);this.resolveListeners.push(function(b){try{"function"!==typeof a?Z(c,b):Z(c,a(b))}catch(g){c._reject(g)}});this.rejectListeners.push(function(a){try{"function"!==typeof b?c._reject(a):Z(c,b(a))}catch(g){c._reject(g)}});2===this.state&&this._resolve(this.value);3===this.state&&this._reject(this.reason);return c};v.prototype._resolve=function(a){3!==this.state&&(this.state===I&&(this.state=2,this.value=a),Va(this.resolveListeners,this.value))};v.prototype._reject=function(a){2!==this.state&&(this.state===I&&(this.state=3,this.reason=a),Va(this.rejectListeners,this.reason))};v.prototype.cancel=function(){this.cancelFn&&(this.cancelFn(),this.cancelFn=null,this._resolve(!1))};v.prototype.onComplete=function(a){this.resolveListeners.push(a);return this};v.prototype.onError=function(a){this.rejectListeners.push(a);return this};u.prototype.reverse=function(){return this.parent.reverse().async()};u.prototype.find=function(a){var b;return this.each(function(c,d){if(a(c,d))return b=c,!1}).then(function(){return b})};u.prototype.indexOf=function(a){var b=-1;return this.each(function(c,d){if(c===a)return b=d,!1}).then(function(){return b})};u.prototype.contains=function(a){var b=!1;return this.each(function(c){if(c===a)return b=!0,!1}).then(function(){return b})};u.prototype.async=function(){return this};E.prototype.watch=function(a){return new Wa(this.source,a)};Wa.prototype=Object.create(u.prototype);Wa.prototype.each=function(a){this.listeners.push(a)};J.prototype=Object.create(u.prototype);J.prototype.isAsync=function(){return!0};J.prototype.split=function(a){return new aa(this,a)};aa.prototype=Object.create(d.prototype);aa.prototype.getEachForDelimiter=function(a){return a instanceof RegExp?this.regexEach:this.stringEach};aa.prototype.regexEach=function(a){var b=ma(this.delimiter),c="",d=0,f,k=0,h=this.parent.each(function(e){for(c+=e;e=b.exec(c);){f=e.index;if(!1===a(c.substring(d,f),k++))return!1;d=f+e[0].length}c=c.substring(d);d=0});h.onComplete(function(){0<c.length&&a(c,k++)});return h};aa.prototype.stringEach=function(a){var b=this.delimiter,c=0,d="",f=this.parent.each(function(e){for(d+=e;0<=(e=d.indexOf(b));){var f=d.substr(0,e);d=d.substr(e+b.length);if(!1===a(f,c++))return!1}return!0});f.onComplete(function(){a(d,c++)});return f};J.prototype.lines=function(){return this.split("\n")};J.prototype.match=function(a){return new Xa(this,a)};Xa.prototype=Object.create(u.prototype);Xa.prototype.each=function(a){var b=this.pattern,c=!1,d=0;return this.parent.each(function(e){f(e).match(b).each(function(b){if(!1===a(b,d++))return c=!0,!1});return!c})};f.createWrapper=function(a){var b=function(){this.listeners=[]};b.prototype=Object.create(J.prototype);b.prototype.each=function(a){this.listeners.push(a)};b.prototype.emit=function(a){for(var b=this.listeners,c=b.length-1;0<=c;--c)!1===b[c](a)&&b.splice(c,1)};return function(){var c=new b;a.apply(c,arguments);return c}};f.generate=function(a,b){return new H(a,b)};f.range=function(){var a=1<arguments.length?arguments[0]:0,b=1<arguments.length?arguments[1]:arguments[0],c=2<arguments.length&&arguments[2];!1===c&&(c=b>a?1:-1);return 0===c?f([]):f.generate(function(b){return a+c*b}).take(Math.ceil((b-a)/c))};f.repeat=function(a,b){return f.generate(function(){return a},b)};f.Sequence=d;f.ArrayLikeSequence=n;f.ObjectLikeSequence=l;f.StringLikeSequence=q;f.StreamLikeSequence=J;f.GeneratedSequence=H;f.AsyncSequence=u;f.AsyncHandle=v;f.clone=function(a){return f(a).value()};f.deprecate=function(a,b){return function(){console.warn(a);return b.apply(this,arguments)}};var y=Array.isArray||function(a){return a instanceof Array},hb=Array.prototype.pop,K=Array.prototype.slice;f.curry=function(a,b){function c(d){return d.length<b?function(){return c(d.concat(K.call(arguments,0)))}:a.apply(null,d)}b||(b=a.length);return c([])};f.curryRight=function(a,b){function c(d){return d.length<b?function(){return c(K.call(arguments,0).concat(d))}:a.apply(null,d)}b||(b=a.length);return c([])};f.createCallback=r;f.createComparator=bb;G.prototype.add=function(a){var b=this.table;switch(typeof a){case "number":case "boolean":case "undefined":return b[a]?!1:b[a]=!0;case "string":switch(a.charAt(0)){case "_":case "f":case "t":case "c":case "u":case "@":case "0":case "1":case "2":case "3":case "4":case "5":case "6":case "7":case "8":case "9":case "N":a="@"+a}return b[a]?!1:b[a]=!0;default:return b=this.objects,A(b,a)?!1:(b.push(a),!0)}};G.prototype.contains=function(a){switch(typeof a){case "number":case "boolean":case "undefined":return!!this.table[a];case "string":switch(a.charAt(0)){case "_":case "f":case "t":case "c":case "u":case "@":case "0":case "1":case "2":case "3":case "4":case "5":case "6":case "7":case "8":case "9":case "N":a="@"+a}return!!this.table[a];default:return A(this.objects,a)}};Za.prototype.add=function(a){var b=this.contents,c=b.length,d=this.start;this.count===c?(b[d]=a,this.start=(d+1)%c):b[this.count++]=a;return this};Za.prototype.toArray=function(){var a=this.contents,b=this.start,c=this.count;b=a.slice(b,b+c);b.length<c&&(b=b.concat(a.slice(0,c-b.length)));return b};return f});(function(m){function f(d){this.source=d}function d(d){this.source=d}function x(d,f){this.elements=d;this.eventName=f}function p(d){this.url=d}f.prototype=new m.ArrayLikeSequence;f.prototype.get=function(d){return this.source[d]};f.prototype.length=function(){return this.source.length};f.prototype.flatten=function(){return new d(this.source)};d.prototype=new m.Sequence;d.prototype.each=function(d){var f=0,h=!1;m(this.source).each(function(p){if(!1===d(p,f++))return!1;m(p.children).flatten().each(function(p){if(!1===d(p,f++))return h=!0,!1});if(h)return!1})};f.prototype.on=function(d){return new x(this.source,d)};x.prototype=new m.Sequence;x.prototype.each=function(d){for(var f=this.elements,h=this.eventName,p=function(m){if(!1===d(m))for(m=0;m<f.length;++m)f[m].removeEventListener(h,p)},m=0;m<f.length;++m)f[m].addEventListener(this.eventName,p)};m.events=m.deprecate("Lazy.events is deprecated. Use Lazy(element[s]).on('event') instead",function(d,f){return new x(d,f)});p.prototype=new m.StreamLikeSequence;p.prototype.each=function(d){var f=new XMLHttpRequest,h=0,p=!1;f.open("GET",this.url);var x=new m.AsyncHandle;f.addEventListener("progress",function t(k){if(!p){k=f.responseText.substring(h);try{!1===d(k)&&(f.removeEventListener("progress",t,!1),f.abort(),p=!0,x._resolve(!1)),h+=k.length}catch(S){x._reject(S)}}},!1);f.addEventListener("load",function(){x._resolve(!0)});f.send();return x};m.makeHttpRequest=function(d){return new p(d)};m.extensions||(m.extensions=[]);m.extensions.push(function(d){if(d instanceof NodeList||d instanceof HTMLCollection)return new f(d);if(d instanceof Element)return new f([d])})})(self.Lazy);(function(m){m(function(){function f(d){this._fn=d}function d(d){return new f(d)}function m(d){return f.isLazyArray(d)?d.fn()[0]:Array.isArray(d)?d[0]:void 0}function p(d){return f.isLazyArray(d)?d.fn()[1]:Array.isArray(d)?d.slice(1):[]}function h(d,h){return f.isLazyArray(h)?[d,h]:[d].concat(Array.isArray(h)?h:[])}function L(f,t){return d(function(){return 1<=f?h(m(t),L(f-1,p(t))):[]})}function z(f,t){return d(function(){for(var d;0<=f--;)d=m(t),t=p(t);return h(d,t)})}function M(d){for(var f=[],k;"undefined"!==typeof(k=m(d));)f.push(k),d=p(d);return f}function N(f,t){return d(function(){var d=m(t);return"undefined"!==typeof d?h(f(d),N(f,p(t))):[]})}function B(f,t){return d(function(){var d=m(t),k=p(t);return"undefined"!==typeof d?f(d)?h(d,B(f,k)):h(m(k),B(f,p(k))):[]})}f.prototype.fn=function(){this.hasOwnProperty("_cache")||(this._cache=this._fn());return this._cache};f.isLazyArray=function(d){return d instanceof f};return{LazyArray:f,create:d,first:m,rest:p,cons:h,second:function(d){return m(p(d))},take:L,drop:z,nth:function(d,f){return m(z(f,d))},all:M,last:function(d){d=M(d);return d[d.length-1]},map:N,filter:B,reduce:function(d,f,h){for(var k;"undefined"!==typeof(k=m(h));)f=d(f,k),h=p(h);return f}}})})(function(m){self.LazyArray=m()});